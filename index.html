<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My AI Chat</title>
    <style>
        * { box-sizing: border-box; font-family: system-ui, Arial; }

        body {
          margin: 0;
          background: #f7f7f8;
          height: 100vh;
          display: flex;
        }

        /* ---------- SIDEBAR ---------- */
        .sidebar {
          width: 220px;
          background: #202123;
          color: white;
          padding: 10px;
          display: flex;
          flex-direction: column;
        }

        .sidebar h3 { margin: 10px 0; }
        .history { flex: 1; overflow-y: auto; }
        .history div {
          padding: 8px;
          background: #2d2f36;
          margin-bottom: 6px;
          border-radius: 6px;
          font-size: 13px;
          cursor: pointer;
        }

        /* ---------- MAIN APP ---------- */
        .app {
          flex: 1;
          display: flex;
          flex-direction: column;
          background: white;
        }

        .header {
          background: #10a37f;
          color: white;
          padding: 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .toggle {
          background: white;
          color: #10a37f;
          border: none;
          padding: 5px 10px;
          cursor: pointer;
          border-radius: 6px;
          font-size: 12px;
        }

        .chat {
          flex: 1;
          padding: 15px;
          overflow-y: auto;
          background: #f7f7f8;
        }

        .message {
          max-width: 70%;
          margin-bottom: 10px;
          padding: 10px;
          border-radius: 10px;
          font-size: 14px;
          line-height: 1.4;
          position: relative;
        }

        .user {
          background: #dbeafe;
          margin-left: auto;
        }

        .ai {
          background: #ececf1;
          margin-right: auto;
        }

        .time {
          font-size: 10px;
          color: gray;
          margin-top: 3px;
          text-align: right;
        }

        .avatar {
          font-size: 18px;
          margin-right: 6px;
        }

        .input-box {
          display: flex;
          border-top: 1px solid #ddd;
          background: white;
        }

        .input-box input {
          flex: 1;
          border: none;
          padding: 12px;
          outline: none;
          font-size: 14px;
        }

        .input-box button {
          border: none;
          background: #10a37f;
          color: white;
          padding: 0 18px;
          cursor: pointer;
        }

        /* ---------- TYPING ---------- */
        .typing {
          font-style: italic;
          color: gray;
          margin-bottom: 8px;
        }

        /* ---------- DARK MODE ---------- */
        body.dark {
          background: #0f0f0f;
        }

        body.dark .app { background: #121212; }
        body.dark .chat { background: #121212; }
        body.dark .message.user { background: #1e3a8a; color: white; }
        body.dark .message.ai { background: #2a2a2a; color: white; }
        body.dark .input-box { background: #1a1a1a; }
        body.dark .input-box input { background: #1a1a1a; color: white; }
    </style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h3>üí¨ History</h3>
    <div id="history" class="history"></div>
</div>

<!-- MAIN APP -->
<div class="app">
    <div class="header">
        <div>ü§ñ My AI</div>
        <button class="toggle" onclick="toggleDark()">Dark</button>
    </div>

    <div id="chat" class="chat"></div>

    <div class="input-box">
        <input id="msg" placeholder="Send a message..." />
        <button onclick="send()">Send</button>
    </div>
</div>

<script>
    const chat = document.getElementById("chat");
    const historyBox = document.getElementById("history");

    function timeNow() {
      const d = new Date();
      return d.getHours() + ":" + String(d.getMinutes()).padStart(2,"0");
    }

    function addHistory(text) {
      const h = document.createElement("div");
      h.innerText = text.slice(0,20);
      historyBox.appendChild(h);
    }

    function addMessage(text, type) {
      const div = document.createElement("div");
      div.className = "message " + type;

      const avatar = type === "user" ? "üßë" : "ü§ñ";
      div.innerHTML = `<span class="avatar">${avatar}</span>${text}
                       <div class="time">${timeNow()}</div>`;

      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function showTyping() {
      const t = document.createElement("div");
      t.id = "typing";
      t.className = "typing";
      t.innerText = "ü§ñ AI is typing...";
      chat.appendChild(t);
      chat.scrollTop = chat.scrollHeight;
    }

    function removeTyping() {
      const t = document.getElementById("typing");
      if (t) t.remove();
    }

    function send() {
      const input = document.getElementById("msg");
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, "user");
      addHistory(text);
      input.value = "";

      showTyping();

     fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
      })
      .then(res => res.json())
      .then(data => {
        removeTyping();
        addMessage(data.reply, "ai");
      })
      .catch(() => {
        removeTyping();
        addMessage("‚ùå Server not responding", "ai");
      });
    }

    function toggleDark() {
      document.body.classList.toggle("dark");
    }
</script>

</body>
</html>
